!function(t){t.fn.reactionCounter=function(e){function a(e,a){var o=e.substr(e.lastIndexOf("/")+1)
return t.ajax({url:"https://graph.facebook.com/v2.9/"+o+"?access_token="+a,method:"GET",dataType:"json",async:!1}).done(function(t){n=t.id}).fail(function(t){s.postID=null,console.log(t.status+" - "+t.responseJSON.error.message)}),n}function o(){var e=r.map(function(t){var e=t
return"reactions.type("+t.toUpperCase()+").limit(0).summary(total_count).as("+e+")"})
e.push("reactions.limit(0).summary(total_count).as(total)"),t.ajax({url:"https://graph.facebook.com/v2.9/?ids="+s.postID+"&fields="+e.join(",")+"&access_token="+i,method:"GET",dataType:"json"}).done(function(e){var a=[],o=0
t.each(e[s.postID],function(t,e){"total"!=t&&"id"!=t&&(o+=this.summary.total_count)}),t.each(l,function(n,r){var c=t(this).data("reaction"),l=e[s.postID][c].summary.total_count
t(this).find(".fbr-counter").text(s.defaultCount+l),t(this).attr("data-reaction-total",l).attr("data-reaction-percent",l/o*100),a.push(c+" ("+l+" ["+(l/o*100).toFixed(1)+"%])")}),"selected"===s.totalType?(c.attr("data-reaction-total",o),t(s.totalSelector).text(o)):"all"===s.totalType&&(c.attr("data-reaction-total",e[s.postID].total.summary.total_count),t(s.totalSelector).text(e[s.postID].total.summary.total_count)),!0===s.showOutput&&(a.push("total("+o+")"),console.log("Data: "+a.join(" | ")))}).fail(function(t){console.log(t.status+" - "+t.responseJSON.error.message)})}var n,s=t.extend({pageURL:"",clientID:"",clientSecret:"",postID:"",refreshTime:5,defaultCount:0,showOutput:!0,totalSelector:".fbr-total",totalType:"selected"},e),r=[],c=this,l=this.find("[data-reaction]").not("p"),i=function(e,a){var o={client_id:e,client_secret:a,grant_type:"client_credentials"}
return t.ajax({url:"https://graph.facebook.com/oauth/access_token?"+t.param(o),type:"GET",dataType:"json",async:!1}).done(function(t){i=t.access_token}).fail(function(t){console.log(t.status+" - "+t.responseJSON.error.message)}),i}(s.clientID,s.clientSecret)
s.pageURL&&s.clientID&&s.clientSecret&&s.postID||alert("Please fill out the required plugin settings: pageURL, clientID, clientSecret, postID"),(n=a(s.pageURL,i))&&(s.postID=a(s.pageURL,i)+"_"+s.postID),i&&null!=s.postID&&function(){t.each(l,function(e,a){r.push(t(this).data("reaction"))
var o=t("<span>",{class:"fbr-counter"})
"append"===s.appendPrepend?t(this).append(o):t(this).prepend(o)}),setInterval(o,1e3*parseInt(s.refreshTime)),o()}()}}(jQuery)
